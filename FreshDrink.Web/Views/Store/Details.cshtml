@model FreshDrink.Web.Models.DrinkListItem

@{
    ViewData["Title"] = Model.Name;

    string img = string.IsNullOrWhiteSpace(Model.ImageUrl)
        ? Url.Content("~/img/placeholder.jpg")
        : Model.ImageUrl.StartsWith("http")
            ? Model.ImageUrl
            : Url.Content(Model.ImageUrl.StartsWith("/img/")
                ? Model.ImageUrl
                : $"~/img/drinks/{Model.ImageUrl}");
}

<div class="container py-5 product-detail">

    <div class="row g-5 align-items-center">

        <!-- IMAGE -->
        <div class="col-12 col-md-6">
            <div class="detail-img-wrapper shadow rounded-4 overflow-hidden">
                <img src="@img" alt="@Model.Name" class="detail-img w-100" style="object-fit:cover;" />
            </div>
        </div>

        <!-- CONTENT -->
        <div class="col-12 col-md-6">

            <h2 class="fw-bold mb-2">@Model.Name</h2>

            <!-- CATEGORY -->
            <span class="badge bg-light border text-dark mb-3 d-inline-flex align-items-center gap-1">
                <i class="bi bi-tag"></i> @Model.CategoryName
            </span>

            <!-- ‚≠ê RATING + REVIEWS -->
            <div class="mb-3">
                <span class="text-warning fs-5">

                    @{
                        int fullStars = (int)Math.Round(Model.Rating);
                    }

                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= fullStars)
                        {
                            <i class="bi bi-star-fill"></i>
                        }
                        else
                        {
                            <i class="bi bi-star"></i>
                        }
                    }
                </span>

                <span class="text-muted">
                    (@Model.ReviewsCount ƒë√°nh gi√°)
                </span>
            </div>

            <!-- üî• SOLD COUNT -->
            <div class="text-muted mb-3">
                üõç <b>@Model.SoldCount</b> l∆∞·ª£t mua
            </div>

            <!-- PRICE -->
            <div class="price-box mb-4">
                <span class="price text-success fw-bold fs-3">
                    @String.Format("{0:N0}ƒë", Model.Price)
                </span>
            </div>

            <!-- BUTTONS -->
            <div class="d-flex gap-3">
                <a asp-controller="Store" asp-action="Index" class="btn btn-outline-secondary px-4 rounded-pill">
                    ‚Üê Quay l·∫°i
                </a>

                <form asp-controller="Cart" asp-action="Add" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="drinkId" value="@Model.Id" />
                    <button class="btn btn-success px-4 rounded-pill" type="submit">
                        üõí Th√™m v√†o gi·ªè
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================= -->
    <!-- üßÉ REVIEW FORM -->
    <!-- ============================= -->
    <hr class="my-5" />

    <h4 class="fw-bold mb-3">ƒê√°nh gi√° s·∫£n ph·∫©m</h4>

    @if (User.Identity!.IsAuthenticated)
    {
        <form asp-controller="Reviews" asp-action="Add" method="post" class="border p-4 rounded-4 bg-light mb-4">
            @Html.AntiForgeryToken()
            <input type="hidden" name="drinkId" value="@Model.Id" />

            <label class="fw-semibold">Ch·ªçn s·ªë sao:</label>
            <select name="rating" class="form-select w-auto mb-3">
                <option value="5">‚≠ê 5 - Tuy·ªát v·ªùi</option>
                <option value="4">‚≠ê 4 - T·ªët</option>
                <option value="3">‚≠ê 3 - T·∫°m ·ªïn</option>
                <option value="2">‚≠ê 2 - T·ªá</option>
                <option value="1">‚≠ê 1 - R·∫•t t·ªá</option>
            </select>

            <textarea name="comment" class="form-control mb-3" rows="3" placeholder="Vi·∫øt c·∫£m nh·∫≠n c·ªßa b·∫°n..."></textarea>

            <button class="btn btn-primary rounded-pill px-4">G·ª≠i ƒë√°nh gi√°</button>
        </form>
    }
    else
    {
        <div class="alert alert-info">
            üîê B·∫°n c·∫ßn <a href="/account/login" class="fw-bold text-decoration-underline">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ ƒë√°nh gi√°.
        </div>
    }

    <!-- ============================= -->
    <!-- üí¨ REVIEW LIST -->
    <!-- ============================= -->
    <h4 class="fw-bold mt-4 mb-3">B√¨nh lu·∫≠n c·ªßa kh√°ch h√†ng</h4>

    @if (ViewBag.Reviews != null && ViewBag.Reviews.Count > 0)
    {
        @foreach (var r in ViewBag.Reviews)
        {
            <div class="border rounded-4 p-3 mb-3">
                <strong>@r.UserName</strong>
                <br />

                <span class="text-warning">
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= r.Rating) { <i class="bi bi-star-fill"></i> }
                        else { <i class="bi bi-star"></i> }
                    }
                </span>

                <p class="mt-2">@r.Comment</p>
                <small class="text-muted">@r.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
            </div>
        }
    }
    else
    {
        <p class="text-muted">‚õî Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
    }
</div>
